<html>

<head>

	<meta charset="utf-8">

	<title>IAT 355 Open Lab 1</title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<style type="text/css">
	/* line 5, /home/elrond/Desktop/Timeline/app/assets/stylesheets/welcome.css.scss */
	.axis path,
	.axis line {
	  fill: none;
	  stroke: black;
	  shape-rendering: crispEdges;
	}

	/* line 11, /home/elrond/Desktop/Timeline/app/assets/stylesheets/welcome.css.scss */
	.axis text {
	  font-family: sans-serif;
	  font-size: 11px;
	}
	</style>
</head>

<body>

	<div data-nd="n4j-1">
	</div>

	<div id="svg-div">
	
	</div>

	<script type="text/javascript">

	var width = 800;
	var height = 600;

	var svg = d3.select("#svg-div")
	            .append("svg")
	            .attr("id", "svg-container")
	            .attr("width", width)
	            .attr("height", height);

	var padding = {top: 10, bottom: 30, left: 50, right: 15};


	var force = d3.layout.force()
					.size([width - padding.left - padding.right, height - padding.bottom - padding.top]);

	var nodesToShow = undefined;
	var currentGraphDataObj;


	function showOnlyNodes(showNodes){
		d3.selectAll("circle")
			.attr("r", function(d, i){
				if( showNodes.indexOf(d["n4jId"]) > -1 ){
					return 10
				}else{
					return 0
				}
			})
	}

	function drawGraphFromJsonString(jsonString){
		var graph = JSON.parse(jsonString);
		drawGraph(graph);
	}


	function drawGraph(graph){
		
		currentGraphDataObj = graph

		console.log("Nodes to Show: " + nodesToShow + " " + (nodesToShow === undefined))


		d3.select("svg").html("");

		force.nodes(currentGraphDataObj.nodes).links(currentGraphDataObj.links).start();

		var link = svg.selectAll(".link")
					.data(currentGraphDataObj.links)
					.enter()
					.append("line");

		var node = svg.selectAll(".node")
					.data(currentGraphDataObj.nodes)
					.enter()
					.append("circle")
					.filter(function(d,i){
						if(nodesToShow === undefined){
							return true
						}else{
							flag = nodesToShow.indexOf(d["n4jId"]) > -1
							console.log(flag)
							return flag
						}
					})
					.attr("data-nd", function(d, i){
						return "n4j-"+d["n4jId"];
					})
					.attr("r", 10)
					.call(force.drag);

		force.on("tick", function() {
			link.attr("x1", function(d) { return d.source.x; })
			.attr("y1", function(d) { return d.source.y; })
			.attr("x2", function(d) { return d.target.x; })
			.attr("y2", function(d) { return d.target.y; });

			node.attr("cx", function(d) { return d.x; })
			.attr("cy", function(d) { return d.y; });
		});		
	}
	</script>
</body>

</html>
